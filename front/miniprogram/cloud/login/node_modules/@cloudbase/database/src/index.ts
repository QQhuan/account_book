import { Point } from './geo/point'
import * as Geo from './geo/index'
import { CollectionReference } from './collection'
import { Command } from './command'
import { ServerDateConstructor } from './serverDate/index'
import { RegExpConstructor } from './regexp/index'
import { startTransaction, runTransaction } from './transaction/index'
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
import { ObjectIdConstructor } from './ObjectId/index'
=======
import { LogicCommand } from './commands/logic'
import { QueryCommand } from './commands/query'
import { UpdateCommand } from './commands/update'
>>>>>>> Stashed changes
=======
import { LogicCommand } from './commands/logic'
import { QueryCommand } from './commands/query'
import { UpdateCommand } from './commands/update'
>>>>>>> Stashed changes
=======
import { LogicCommand } from './commands/logic'
import { QueryCommand } from './commands/query'
import { UpdateCommand } from './commands/update'
>>>>>>> Stashed changes
=======
import { LogicCommand } from './commands/logic'
import { QueryCommand } from './commands/query'
import { UpdateCommand } from './commands/update'
>>>>>>> Stashed changes
=======
import { LogicCommand } from './commands/logic'
import { QueryCommand } from './commands/query'
import { UpdateCommand } from './commands/update'
>>>>>>> Stashed changes
=======
import { LogicCommand } from './commands/logic'
import { QueryCommand } from './commands/query'
import { UpdateCommand } from './commands/update'
>>>>>>> Stashed changes

/**
 * 地理位置类型
 */
interface GeoTeyp {
  Point: typeof Point
}

export { Query } from './query'
export { CollectionReference } from './collection'
export { DocumentReference } from './document'

<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
interface ICloudBaseConfig {
  timeout?: number
  isHttp?: boolean
  secretId?: string
  secretKey?: string
  envName?: string
  env?: string
  sessionToken?: string
  serviceUrl?: string
  headers?: any
  proxy?: string
  version?: string
  credentials?: ICredentialsInfo
  _useFeature?: boolean // 是否走新特性
  throwOnCode?: boolean // 错误回包(带code) throw
}

interface ICredentialsInfo {
  private_key_id: string
  private_key: string
}

=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
/**
 * 数据库模块
 *
 * @author haroldhu
 */
export class Db {
  /**
   * Geo 类型
   */
  Geo: GeoTeyp

  /**
   * 逻辑操作的命令
   */
  command: typeof Command

  RegExp: any

  serverDate: any

<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
  ObjectId: any

=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
  startTransaction: any

  runTransaction: any

<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
=======
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
  logicCommand: any

  updateCommand: any

  queryCommand: any

<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
  /**
   * 初始化
   *
   * 默认是 `default` 数据库，为今后扩展使用
   *
   * @param config
   */
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
  config: ICloudBaseConfig
=======
  config: any
>>>>>>> Stashed changes
=======
  config: any
>>>>>>> Stashed changes
=======
  config: any
>>>>>>> Stashed changes
=======
  config: any
>>>>>>> Stashed changes
=======
  config: any
>>>>>>> Stashed changes
=======
  config: any
>>>>>>> Stashed changes

  static ws: any

  static reqClass: any

  static wsClass: any

  // 创建签名的工具函数，由jssdk传入
  static createSign: Function

  static getAccessToken: Function
  // 由jssdk传入
  static dataVersion: string
  // 运行环境，由jssdk传入
  static runtime: string
  // 应用签名信息，由jssdk传入
  static appSecretInfo: any

  constructor(config?: any) {
    this.config = config
    this.Geo = Geo
    this.serverDate = ServerDateConstructor
    this.command = Command
    this.RegExp = RegExpConstructor
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
    this.ObjectId = ObjectIdConstructor
    this.startTransaction = startTransaction
    this.runTransaction = runTransaction
=======
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
    this.startTransaction = startTransaction
    this.runTransaction = runTransaction

    // 暴露command类 给新sdk灰度兼容用
    this.logicCommand = LogicCommand
    this.updateCommand = UpdateCommand
    this.queryCommand = QueryCommand
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
<<<<<<< Updated upstream
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
  }

  /**
   * 获取集合的引用
   *
   * @param collName - 集合名称
   */
  collection(collName: string): CollectionReference {
    if (!collName) {
      throw new Error('Collection name is required')
    }
    return new CollectionReference(this, collName)
  }

  /**
   * 创建集合
   */
  createCollection(collName: string) {
    let request = new Db.reqClass(this.config)

    const params = {
      collectionName: collName
    }

    return request.send('database.addCollection', params)
  }
}
